<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Iraq Chat</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  background:#0b1220;
  font-family:tahoma;
  color:#fff;
}
#chat{
  height:80vh;
  overflow-y:auto;
  padding:10px;
}
.msg{
  background:#1b2437;
  margin:6px 0;
  padding:8px;
  border-radius:6px;
}
#bar{
  display:flex;
  gap:5px;
  padding:10px;
  background:#0e1627;
}
input,button{
  padding:10px;
  border:none;
  border-radius:5px;
  font-size:14px;
}
#username{width:25%}
#message{flex:1}
button{
  background:#22c55e;
  color:#000;
  font-weight:bold;
  cursor:pointer;
}
</style>
</head>

<body>

<div id="chat"></div>

<div id="bar">
  <input id="username" placeholder="اسمك">
  <input id="message" placeholder="اكتب رسالة">
  <button id="sendBtn">إرسال</button>
</div>

<!-- Firebase v8 -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
var firebaseConfig = {
  apiKey: "AIzaSyA4kEy6GwS9rk7kcj1s-YKZR9S2DdElhI0",
  authDomain: "iraq-chat-app.firebaseapp.com",
  databaseURL: "https://iraq-chat-app-default-rtdb.firebaseio.com",
  projectId: "iraq-chat-app",
  storageBucket: "iraq-chat-app.appspot.com",
  messagingSenderId: "835268079324",
  appId: "1:835268079324:web:ccb8e8f3a12cdb2da98e19"
};

firebase.initializeApp(firebaseConfig);

var auth = firebase.auth();
var db = firebase.database();
var chatRef = db.ref("rooms/baghdad/messages");

// تسجيل دخول مجهول (الحل السحري)
auth.signInAnonymously().catch(function(error){
  console.error("Auth error:", error);
});

document.getElementById("sendBtn").onclick = function(){
  var name = document.getElementById("username").value.trim();
  var text = document.getElementById("message").value.trim();
  if(!name || !text) return;

  chatRef.push({
    name: name,
    text: text,
    time: Date.now()
  }).catch(function(err){
    alert("خطأ في الإرسال");
    console.error(err);
  });

  document.getElementById("message").value="";
};

chatRef.limitToLast(100).on("child_added", function(snap){
  var d = snap.val();
  var div = document.createElement("div");
  div.className = "msg";
  div.innerHTML = "<b>"+d.name+":</b> " + d.text;
  document.getElementById("chat").appendChild(div);
  document.getElementById("chat").scrollTop = document.getElementById("chat").scrollHeight;
});
</script>

</body>
</html>
